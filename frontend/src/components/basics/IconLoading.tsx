import { useState, useEffect, useMemo } from "react";
import { useTranslation } from "react-i18next";

const IconLoading = () => {
  const { t } = useTranslation();

  // texts需要用useMemo包裹，否则每次渲染都会重新生成，导致useEffect依赖不稳定
  const texts = useMemo(
    () => [
      t("loading.wait"),
      t("loading.connecting"),
      t("loading.retry.first"),
      t("loading.retry.second"),
      t("loading.retry.third"),
      t("loading.thanks"),
      t("loading.report"),
    ],
    [t]
  );

  const [currentTextIndex, setCurrentTextIndex] = useState(0);

  useEffect(() => {
    // 如果只有[]作为依赖，texts.length可能为0，导致NaN
    if (texts.length === 0) return;
    setCurrentTextIndex(0); // 语言切换时重置索引
    const interval = setInterval(() => {
      setCurrentTextIndex((prevIndex) => (prevIndex + 1) % texts.length);
    }, 4000);

    return () => clearInterval(interval);
  }, [texts]);

  return (
    <div className="fixed inset-0 flex flex-col items-center justify-center gap-2 ">
      <div className="w-28 h-28 relative mb-0">
        <svg viewBox="0 0 496 496" className="w-full h-full">
          <defs>
            <linearGradient id="gradient0" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" className="[stop-color:var(--color-primary)]" />
              <stop offset="100%" className="[stop-color:var(--color-secondary)]" />
            </linearGradient>
            <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" className="[stop-color:var(--color-secondary)]" />
              <stop offset="100%" className="[stop-color:var(--color-accent)]" />
            </linearGradient>
            <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" className="[stop-color:var(--color-accent)]" />
              <stop offset="100%" className="[stop-color:var(--color-primary)]" />
            </linearGradient>
            <linearGradient id="gradient3" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" className="[stop-color:var(--color-primary)]" />
              <stop offset="100%" className="[stop-color:var(--color-secondary)]" />
            </linearGradient>
          </defs>

          <path
            className="path-animation"
            d="M427.354126,208.312195 
    C428.959686,215.983795 429.937317,223.730469 430.512421,231.552078 
    C433.843170,276.852051 423.688965,318.194031 392.773682,352.508392 
    C361.358978,387.377228 321.367584,399.005859 275.516266,392.439423 
    C274.330383,392.269592 272.678680,392.518188 272.541199,389.939056 
    C308.134521,390.015228 340.039673,379.292694 367.189392,356.059479 
    C394.590271,332.611328 409.782867,302.767548 412.630493,266.793030 
    C412.045593,267.029221 411.685486,267.406754 411.559631,267.850693 
    C405.476013,289.312393 394.635864,308.039642 378.610535,323.530212 
    C354.812866,346.533783 326.798523,356.717346 293.653412,350.211151 
    C291.680084,349.823792 289.336029,349.913971 287.938171,347.094910 
    C295.712067,344.195312 304.299438,344.353638 311.202026,339.312653 
    C264.472443,336.046906 221.832886,323.543030 188.384232,288.465805 
    C196.912201,304.595184 208.036224,318.368591 221.316696,330.459625 
    C234.668732,342.615845 249.788269,351.738403 266.761200,357.959656 
    C283.626770,364.141510 301.224152,364.443909 319.020355,364.546967 
    C318.657379,365.670044 318.289948,366.041748 317.846893,366.195526 
    C316.749634,366.576294 315.631927,366.922760 314.497620,367.168396 
    C302.957428,369.667633 291.396118,369.595490 279.750488,367.780609 
    C247.452118,362.747223 219.970947,347.909180 195.557632,326.747253 
    C192.519913,324.114136 189.392044,321.649475 185.567612,320.239655 
    C178.607681,317.673920 171.599335,320.718079 168.616867,327.499817 
    C165.992218,333.467834 167.935730,338.560425 171.528915,343.322632 
    C204.563980,387.105438 247.671555,410.814209 303.351288,407.858521 
    C344.352509,405.682037 379.025848,389.226929 404.320923,356.477936 
    C439.169495,311.360229 445.136749,260.823059 429.186279,206.954193 
    C428.385590,204.250015 427.293854,201.632019 426.337616,198.973892 
    C426.050476,199.081497 425.763336,199.189087 425.476166,199.296677 
    C426.068268,202.024734 426.660370,204.752792 427.354126,208.312195 z"
          />
          <path
            className="path-animation"
            d="M308.735809,287.177002 
    C304.152069,294.046921 298.025909,299.669342 293.119781,306.438904 
    C302.701202,302.251862 310.621490,295.852371 318.449310,289.289673 
    C326.404236,282.620438 333.544006,275.176453 339.801819,266.915955 
    C345.951660,258.797943 351.319397,250.186920 355.581848,240.900543 
    C359.919556,231.450150 362.734070,221.564636 364.713928,211.379089 
    C366.639313,201.473831 365.484955,191.295746 367.149475,181.282120 
    C370.978485,186.649124 371.171021,192.672485 371.152374,198.473053 
    C371.046814,231.347382 359.291687,260.267120 340.330444,286.563095 
    C335.366302,293.447495 329.667114,299.800293 324.666016,306.660034 
    C319.697418,313.475189 320.140930,320.761047 325.265472,325.759766 
    C330.238617,330.610809 337.685577,331.075500 344.025574,326.372986 
    C389.695160,292.498718 414.108948,247.964554 409.662537,190.263657 
    C406.262878,146.146095 385.938843,110.865257 348.929108,86.122665 
    C312.299988,61.634527 271.865265,55.285475 228.887222,63.009916 
    C221.550949,64.328466 214.417908,66.392141 207.593002,69.544645 
    C218.171066,68.256117 228.694885,66.982027 239.338608,66.408863 
    C274.498138,64.515528 307.361328,71.835964 337.074951,90.862869 
    C382.815918,120.152756 400.823334,167.827271 395.132141,216.128937 
    C394.952148,217.656265 394.982849,219.588425 391.643768,219.791931 
    C390.810944,185.306747 379.344757,154.733643 356.829559,128.523094 
    C331.747040,99.323757 293.709625,85.200916 268.988892,85.073650 
    C271.256042,85.812286 272.471924,86.209766 273.688660,86.604618 
    C291.382019,92.346500 307.259674,101.319992 320.875214,113.985405 
    C345.015839,136.441414 357.218414,163.690529 353.152832,197.129791 
    C352.656494,201.211899 352.163635,205.440506 349.420349,209.125671 
    C346.610138,201.172806 346.024170,192.673309 341.130646,185.501770 
    C338.549683,221.900833 330.433075,256.331787 308.735809,287.177002 z"
          />
          <path
            className="path-animation"
            d="M283.505432,428.925598 
    C289.237823,427.075043 294.970184,425.224457 300.702576,423.373901 
    C271.307892,429.819733 241.975815,431.852112 212.429184,425.186279 
    C183.103485,418.570343 157.152725,405.488495 136.592606,383.284485 
    C107.063454,351.394257 98.471504,313.247162 104.763824,271.043243 
    C104.968651,269.669403 104.799889,267.983200 107.539261,267.127884 
    C106.295357,303.526337 116.959091,335.857971 139.775803,363.915619 
    C165.880219,396.016144 205.819077,410.761230 230.165665,410.034485 
    C228.768311,409.602905 227.993011,409.367706 227.220306,409.124237 
    C205.506622,402.282654 186.275681,391.304779 170.946625,374.281311 
    C149.432480,350.389069 140.281448,322.798584 147.141602,290.752701 
    C147.553207,288.830032 147.467865,286.495132 150.223511,284.897995 
    C152.611465,293.363190 152.896149,302.079315 157.889389,309.330597 
    C159.603836,286.338120 163.489243,263.992691 171.690964,242.520660 
    C179.937759,220.930649 192.159943,202.008698 210.555801,185.669846 
    C199.628525,189.795868 180.248901,204.583878 167.938309,218.049438 
    C142.083893,246.329559 129.266708,279.298218 133.746445,318.541901 
    C130.174072,317.114594 130.264191,314.914642 129.890396,313.082092 
    C127.396896,300.857574 127.359467,288.581177 129.428497,276.302322 
    C134.583588,245.708847 148.519699,219.353012 168.377655,195.873444 
    C170.957840,192.822693 173.756958,189.945114 175.702744,186.402618 
    C179.203125,180.029816 178.570114,173.748550 173.981476,169.446884 
    C168.713730,164.508591 161.704361,163.920975 155.672455,168.370453 
    C106.635811,204.542694 82.895164,252.398163 90.477074,313.690521 
    C94.968803,350.001801 112.118858,380.181213 141.152588,402.527161 
    C183.614517,435.208191 231.479355,441.774933 283.505432,428.925598 z"
          />
          <path
            className="path-animation"
            d="M253.061768,95.499374 
    C235.130768,88.920776 216.570221,86.218323 197.566711,87.339779 
    C153.501282,89.940224 117.074928,107.679710 90.958305,143.802757 
    C63.882957,181.251846 56.892162,223.342377 64.798759,268.334427 
    C66.514160,278.095810 69.369202,287.546616 73.227089,296.694031 
    C73.161140,294.521530 72.709053,292.449463 72.283867,290.371887 
    C63.015179,245.082397 66.951851,201.474289 91.916321,161.756096 
    C120.407707,116.426605 162.544907,97.302319 215.600983,101.575642 
    C217.595627,101.736301 220.018738,101.394768 221.339188,104.063774 
    C219.935165,105.890388 217.875626,105.885223 215.967133,105.915688 
    C207.925873,106.044052 200.051056,107.235611 192.260223,109.189842 
    C144.507828,121.167999 110.535286,149.047363 93.002014,195.619888 
    C89.169983,205.798676 86.770172,216.438446 86.663918,227.459610 
    C87.646820,225.871674 88.274406,224.194458 88.856033,222.501450 
    C95.508003,203.138947 105.415535,185.703705 120.310394,171.512100 
    C144.660034,148.312134 173.121979,137.982201 206.797394,145.110886 
    C208.635178,145.499916 210.885681,145.398705 212.370850,148.373817 
    C204.169159,150.981346 195.349655,151.437340 187.926849,156.007027 
    C233.860123,158.563164 275.333527,171.639297 309.040009,204.615601 
    C300.820435,188.756409 289.593475,175.582199 276.523346,163.916855 
    C263.187958,152.014771 248.095932,143.142441 231.148193,137.271370 
    C214.532867,131.515465 197.313843,130.829201 179.647705,131.481880 
    C180.489014,128.402176 182.092896,128.169945 183.512589,127.935310 
    C188.765884,127.067123 193.989273,125.964600 199.352402,125.897308 
    C231.819199,125.489983 260.281372,137.134468 286.469421,155.217575 
    C294.127686,160.505676 300.994690,166.925667 308.485199,172.474762 
    C315.307251,177.528641 322.732574,177.161728 327.600372,172.119110 
    C332.940247,166.587502 333.131653,159.562592 328.082794,152.603348 
    C308.976257,126.267250 284.499359,106.949394 253.061768,95.499374 z"
          />
        </svg>
      </div>

      {/* 加载文字 */}
      <div className="text-2xl font-medium text-theme-text-secondary animate-pulse">
        {texts.length > 0 ? texts[currentTextIndex] : ""}
      </div>

      <style>{`
                .path-animation {
                  animation: morph 2s linear infinite;
                  transform-origin: center;
                }

                @keyframes morph {
                  0% {
                    transform: rotate(0deg);
                  }
                  50% {
                    transform: rotate(180deg);
                  }
                  100% {
                    transform: rotate(360deg);
                  }
                }
            `}</style>
    </div>
  );
};

export default IconLoading;
